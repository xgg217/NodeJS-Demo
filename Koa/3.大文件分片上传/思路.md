# 大文件分片上传解决思路

## 参考文章

>https://mp.weixin.qq.com/s/ogg55GMbIJNUfQQCwhssBg

## 代码地址

>https://github.com/shadowings-zy/easy-file-uploader

## 步骤

1. **前端计算文件 md5** 计算文件的 md5 是为了检查上传到服务器的文件是否与用户所传的文件一致，同时也可以根据 md5 进行「秒传」等操作。

2. **前端发送初始化请求，后端初始化上传**。当计算好文件的 md5 后，就可以进入初始化上传的步骤，在这一步骤中，前端会发起初始化请求，包含这个文件计算的 md5、文件名等信息，而后端则会根据 md5 初始化接收分片文件的目录。

3. **前端进行文件分片，并将分片传输给后端**。这个步骤自不必多说，前端会将文件分成多个小块，并按照一定的策略进行上传，如果遇到上传失败的分片，需要重新上传。

4. **前端发送结束上传请求，后端合并分片**。当发送成功所有的文件分片后，前端会发起结束上传请求，后端收到请求后，会将已有的文件分片合并，生成文件，并确认生成的文件的 md5 是否与初始化传入的 md5 一致。

+ 注意点

  + 值得注意的是，当文件比较大时，直接根据文件「计算 md5」、「进行文件分片」、「合并文件」都是十分消耗内存的（甚至可能直接把内存吃满），因此在这三个步骤，需要使用流来减小内存上的消耗。

## 前端





## 后端提供的服务

1. 初始化文件上传

2. 接收文件分片

3. 合并文件分片

其次，为了使用体验，我们还需要提供如下附加能力：

4. 获取已上传的分片信息

5. 清理分片存储目录（用于取消上传）

+ 具体实现： 首先要写一个 `FileUploaderServer` 类提供上述这些能力。

  + 这样，当开发者在使用 `easy-file-uploader-server` 的时候，只需要实例化 `FileUploaderServer` 类，并在接口中使用这个类提供的方法即可。

